---
title: "Spatial Interpolation Overview"
author: "Arsalan Anwari"
date: "2023-06-05"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# 1. Data preparation
## 1.1 Load libraries 

```{r load_libs, warning=FALSE}

library(jsonlite) # used for wind speed data of knmi station
library(sf) # used to load maps and manipulate spatial features

library(ggplot2) # used to plot maps and other figures
library(tidyverse) # used for piping functionality of data manipulation functions

# Used to fix conflicted packages of dplyr
library(conflicted)
conflict_prefer("filter", "dplyr")
conflict_prefer("lag", "dplyr")

library(gstat) # used for interpolation and validation of IDW and kriging models
library(caret) # used for cross validation of other models

```

## 1.2 Load data

```{r load_data}

# load windspeed measurements
df_knmi_windspeed <- read_json("Data/knmi_winspeed_days_2017.json", simplifyVector = TRUE)
df_knmi_station_coords <- read.csv( "Data/knmi_weather_stations.csv", sep=";")

crs_source <- readRDS("Data/source_map_crs.rds") 
sf_netherlands <- st_read("Data/netherlands_reference_map.gpkg")
ls_best_rmse_weights <- readRDS("Data/weights_with_lowest_rmse_per_opt.rds")

```

## 1.3 Clean windspeed data
### 1.3.1 Rename windspeed dataframe columns

```{r rename_df_windspeed}

df_knmi_windspeed <- df_knmi_windspeed %>% 
  select(station_code, date, FG) %>%
  rename(windspeed = FG)

```

### 1.3.3 Find missing entries and na values

```{r find_missing_stations}
missing_rows_stations <- df_knmi_windspeed %>% 
  group_by(station_code) %>%
  summarise(n = n()) %>%
  filter(n < 365) %>% 
  select(station_code)
  
na_rows_stations <- df_knmi_windspeed %>% 
  filter(is.na(windspeed)) %>%
  select(station_code)
  
missing_knmi_stations <- unique(rbind(missing_rows_stations, na_rows_stations))
  
missing_knmi_stations
```

### 1.3.3 filter out rows with missing entries

```{r filter_df_windspeed}
df_knmi_windspeed <- df_knmi_windspeed %>% 
  filter(!(station_code %in% missing_knmi_stations$station_code))

df_knmi_windspeed

```

## 1.4 Merge location data of `df_knmi_station_coords` with windspeed data of `df_knmi_windspeed` into new variable

```{r merge_knmi_data}

df_knmi_station_coords <- df_knmi_station_coords %>%
  select(STN, LON, LAT, NAME) %>%
  rename(station_code = STN, x=LON, y=LAT, station_name=NAME)

df_knmi_stations <- merge(df_knmi_windspeed, df_knmi_station_coords, by = "station_code")

df_knmi_stations

```

## 1.5 Fix datetime and restructure order of dataframe

```{r clean_knmi_data}

df_knmi_stations <- df_knmi_stations %>% 
  mutate(date=strftime(date, "%d-%m-%Y")) %>%
  mutate(date=as.Date(date, "%d-%m-%Y")) %>%
  select(station_code, station_name, date, x, y, windspeed)

```


## 1.6 Aplly source CRS to reference map and create 5km2 grid

```{r create_reference_grid}

sf_netherlands <- sf_netherlands %>%
  st_geometry() %>%
  st_transform(crs_source)

grid_spacing <- 5000

gs_netherlands_grid <- sf_netherlands %>% 
  st_make_grid(
    square = TRUE, 
    what = "polygons",           
    cellsize = c(grid_spacing, grid_spacing)
  )

sf_netherlands_grid <- gs_netherlands_grid %>% st_sf()

sf_netherlands_grid

```

## 1.7 Remove seatiles and other unneccesary tiles

```{r reduce_reference_grid}

sf_netherlands_grid <- sf_netherlands_grid %>%
  mutate(cell_id = 1:length(lengths(gs_netherlands_grid))) # add cell ID

sf_netherlands_grid$n_intersects <- lengths(
  st_intersects(sf_netherlands_grid, sf_netherlands)
)

sf_netherlands_grid <- sf_netherlands_grid %>%
  filter(n_intersects > 0) %>%
  select(geometry, cell_id)
  
sf_netherlands_grid

```

## 1.8 Show map of grids

```{r show_grid_map}

ggplot() +
  geom_sf(data = sf_netherlands, fill="white", col="black") +
  geom_sf(data = sf_netherlands_grid, alpha=0.1) +
  theme_bw()

```


# 2. Observation and receptor preparation
## 2.1 Take single sample of knmi windspeed timeseries as observations

```{r create_sf_observations}

df_observations <- df_knmi_stations %>% 
  filter(date == as.Date("2017-01-01")) %>% 
  select(!date)

sf_observations <- df_observations %>% 
  st_as_sf(coords = c("x", "y")) %>%
  st_set_crs(4326) %>% # WGS-84
  st_transform(crs_source)
  
sf_observations
df_observations

```

## 2.2 Find grid which intersect with observations. 
```{r observation_receptor_instersect}

sf_receptors <- sf_netherlands_grid
sf_receptors$station_codes <- c(st_intersects(sf_netherlands_grid, sf_observations))

```

### 2.2.1 Create backup grid for plotting

```{r create_netherlands_receptor_grid}

sf_receptors_copy <- sf_netherlands_grid
sf_receptors_copy$station_codes <- c(st_intersects(sf_netherlands_grid, sf_observations))
sf_netherlands_receptor_grid <- sf_receptors_copy %>% filter(lengths(station_codes) == 0)

sf_netherlands_receptor_grid

```

## 2.3 Apply found indexes of intersects with windspeed values.

```{r apply_intersects}

# R has a weird bug where using the mean() function over a flattend list of length 1 used  will take the mean of the entire data frame instead of the selection. 
# Therefor two separate search operations are performed, the results combined # with each other and finally merged with the receptor array.

single_intersects <- sf_receptors %>%
  as.data.frame() %>%
  select(cell_id, station_codes) %>%
  filter(lengths(station_codes) == 1) %>%
  mutate(windspeed = df_observations$windspeed[unlist(station_codes)]) %>%
  select(cell_id, windspeed)

multi_intersects <- sf_receptors %>%
  as.data.frame() %>%
  select(cell_id, station_codes) %>%
  filter(lengths(station_codes) > 1) %>%
  mutate(windspeed = mean(df_observations$windspeed[unlist(station_codes)])) %>%
  select(cell_id, windspeed)

all_intersects <- rbind(single_intersects, multi_intersects)

sf_observations <- merge(sf_receptors, all_intersects, by="cell_id")

```

```{r show_intersection_results}

sf_observations

```

## 2.4 Calculate the centroids of the receptors are use that as the geometry instead of polygons. 

```{r calc_receptor_centroids}

sf_receptors <- sf_receptors %>%
  st_set_geometry(st_centroid(st_geometry(sf_receptors)))

sf_observations <- sf_observations %>%
  st_set_geometry(st_centroid(st_geometry(sf_observations)))

```

## 2.5 Set default value of 0 for receptor variables

```{r set_receptor_variable_default}

sf_receptors <- sf_receptors %>% mutate(windspeed = 0)

```

## 2.6 Remove observation cells from receptor grid

```{r remove_obs_cells_from_receptor_grid}

sf_receptors <- sf_receptors %>%
  filter(lengths(station_codes) == 0)

```

## 2.7 Prepare and save data for other R scripts like dynamic model traning routine

```{r ceate_annual_observations}

sf_observations_anual <- df_knmi_stations %>% 
  st_as_sf(coords = c("x", "y")) %>%
  st_set_crs(4326) %>% # WGS-84
  st_transform(crs_source)

```

```{r split_sf_coords}

sf_receptors <- sf_receptors %>%
  mutate(
    x = st_coordinates(.)[,1],
    y = st_coordinates(.)[,2]
  ) 

sf_observations <- sf_observations %>%
  mutate(
    x = st_coordinates(.)[,1],
    y = st_coordinates(.)[,2]
  )

sf_observations_anual <- sf_observations_anual %>%
  mutate(
    x = st_coordinates(.)[,1],
    y = st_coordinates(.)[,2]
  )

```

```{r save_data_for_dynamic_training}

saveRDS(sf_observations, "Data/knmi_windspeed_observations_training_set.rds")
saveRDS(sf_observations_anual, "Data/knmi_windspeed_complete_set.rds")

```


# 3. Prepare spatial interpolation
## 3.1 Define helper functions

```{r plot_observations}

show_prediction_map <- function(observation_variables, title_text, caption_text){

  sf_netherlands_receptor_grid$windspeed <- 0
  sf_netherlands_receptor_grid$windspeed <- as.factor(ceiling(observation_variables / 10))

  map_plot <- ggplot() +
    geom_sf(
      data = sf_netherlands_receptor_grid,
      aes(fill = windspeed)
    ) +
    scale_fill_grey(start = 0.1, end = 0.9) +
    labs(title = title_text, fill = "windspeed (m/s)", caption = caption_text) +
    theme_bw()
  
  print(map_plot)
}

```


```{r calc_nrmse}

calc_rmse <- function(residuals) {
  return(sqrt(sum((residuals)^2)/length(residuals)))
}

calc_nrmse <- function(rmse, observations){
  return( rmse / sd(observations$windspeed) )
}

```

```{r train_gstat_cv}

train.gstat <- function(model){
  { sink(nullfile()); cv <- gstat.cv(model, nfold = nrow(sf_observations), verbose=FALSE); sink(); }  
  return( list(residuals = cv$residual) )
}

```


## 3.2 Show best combination of weights and settings for spatial interpolation of training set

```{r show_best_weights_per_model_variation}

ls_best_rmse_weights$trend_surface
ls_best_rmse_weights$mqrbf
ls_best_rmse_weights$idw
ls_best_rmse_weights$od_kriging
ls_best_rmse_weights$u_kriging

```
 
Based on these results surfaces will be generated using the following models:
- Linear and hyperbolic trend surface using `weights = (1/windspeed) + case_weight`
- MQ-RBF model with an `alpha_seed = 1.166434` and `smoothing_factor = 90.770461`
- IDW model using `nmax=6` and `idp=1.028791`
- Ordinary kriging using spherical variogram using `vgm(base_range + 36.41014, "Sph", base_psill + 0.3641014)` where `base_range` and `base_psill` where pre-calculated by fitting the variogram using `fit.variogram(...)` and `nmax=6`
- Universal kriging with linear and hyperbolic regression model using `psill=0.4390736, range=43.90736, nmax=6` and `psill=0.5031153, range=50.31153, nmax=6`. 


# 4. Perform spatial interpolation
## 4.1 Train spatial interpolation models
### 4.1.1 Trend surface 

```{r trend_surface_train}

model.trend_surface.linear <- lm(
  formula = windspeed ~ x + y,
  data = sf_observations,
  weights = (1 / windspeed) + 1.151302
)

model.trend_surface.hyperbolic <- lm(
  formula = windspeed ~ x + y + I(x^2) + (x * y) + I(y^2) + I(x^3) + (I(x^2) * y) + (x * I(y^2)) + I(y^3),
  data = sf_observations,
  weights = (1 / windspeed) + 1.000508
)

summary(model.trend_surface.linear)
summary(model.trend_surface.hyperbolic)

```

### 4.1.2 MQ-RBF

```{r mqrbf_model_train_define}

mqrbf.calc_alpha_weights <- function(data, alpha_seed, smoothing_factor) {
  n <- nrow(data)
  K <- matrix(0, n, n)
  for (i in 1:n) {
    for (j in 1:n) {
      K[i,j] <- sqrt(
        1 + ( alpha_seed * 
          ( (sqrt( 
              ( ( data$x[i] - data$x[j] )^2 ) + 
              ( ( data$y[i] - data$y[j] )^2 ) 
            )^2) 
          ) 
        )
      )
      
    }
  }
  
  alpha_weights <- solve(K) %*% data$windspeed
  alpha_weights <- as.vector(alpha_weights)
  
  return(list(
    data = data, 
    alpha_weights = alpha_weights, 
    alpha_seed = alpha_seed, 
    smoothing_factor = smoothing_factor
  ))
}

```

```{r mqrbf_train}

model.mqrbf <- mqrbf.calc_alpha_weights(
    data = sf_observations, 
    alpha_seed = 1.166434,
    smoothing_factor = 90.770461
)

summary(model.mqrbf$alpha_weights)

```

### 4.1.3 IDW

```{r idw_train}

model.idw <- gstat(
  formula = windspeed ~ 1,
  data = sf_observations,
  nmax = 6,
  set = list(idp = 1.028791)
)


```


### 4.1.4 Ordinary kriging

```{r od_kriging_vgm_train}

vgm.od_kriging <- variogram(windspeed ~ 1, data = sf_observations)
model.od_kriging.vgm <- suppressWarnings(fit.variogram(vgm.od_kriging, vgm("Sph")))

base_psill <- model.od_kriging.vgm$psill[1]
base_range <- model.od_kriging.vgm$range[2]

model.od_kriging.vgm.linear <- suppressWarnings(
  fit.variogram(vgm.od_kriging, vgm(
    psill = base_psill + 0.3641014, 
    model = "Sph", 
    range = base_range + 36.41014
    )
  )
)

model.od_kriging.vgm

```

```{r od_kriging_train}

model.od_kriging <- gstat(
  formula = windspeed ~ 1,
  data = sf_observations,
  nmax = 6,
  model = model.od_kriging.vgm
)

```


### 4.1.5 Universal kriging

```{r u_kriging_vgm_train}

vgm.u_kriging <- variogram(windspeed ~ x + y, data = sf_observations)
model.u_kriging.vgm <- suppressWarnings(fit.variogram(vgm.u_kriging, vgm("Sph")))

base_psill <- model.u_kriging.vgm$psill[1]
base_range <- model.u_kriging.vgm$range[2]

model.u_kriging.vgm.linear <- suppressWarnings(
  fit.variogram(vgm.u_kriging, vgm(
    psill = base_psill + 0.4390736, 
    model = "Sph", 
    range = base_range + 43.90736
    )
  )
)

model.u_kriging.vgm.hyperbolic <- suppressWarnings(
  fit.variogram(vgm.u_kriging, vgm(
    psill = base_psill + 0.5031153, 
    model = "Sph", 
    range = base_range + 50.31153
    )
  )
)

model.u_kriging.vgm.linear
model.u_kriging.vgm.hyperbolic

```
- The syntax for a `formula` in the `variogram()` function is unconventional. Here `windspeed ~ x+y` simply indicates "variogram optimized for universal kriging" and `windspeed ~ 1` indicates simple or ordinary kriging.  


```{r u_kriging_train}

model.u_kriging.linear <- gstat(
  formula = windspeed ~ x + y,
  data = sf_observations,
  nmax = 6,
  model = model.u_kriging.vgm.linear
)

model.u_kriging.hyperbolic <- gstat(
  formula = windspeed ~ abs(x + y + (x^2) + (x * y) + (y^2) + (x^3) + ((x^2) * y) + (x * (y^2)) + (y^3)),
  data = sf_observations,
  nmax = 6,
  model = model.u_kriging.vgm.hyperbolic
)

```
- The syntax for the `formula` parameter is unconventional in the `gstat()` function. Exponents do not need a `I(x^n)` clause and `abs()` is used to indicate that a higher order polynomial regression model is used without auxiliary variables. To use auxiliary variables for something like co-kriging you need to remove the `abs(....)` and use `log(windspeed)`.    


## 4.2 Predict receptor points to create surface

### 4.2.1 Trend surface
```{r trend_surface_predict}

preds.trend_surface.linear <- predict(model.trend_surface.linear, sf_receptors)
preds.trend_surface.hyperbolic <- predict(model.trend_surface.hyperbolic, sf_receptors)

summary(preds.trend_surface.linear)
summary(preds.trend_surface.hyperbolic)

```

### 4.2.2 MQ-RBF

```{r mqrbf_predict_model_define}

mqrbf.calc_distance <- function(r, c){
  return ( sqrt( (r^2) + (c^2) ) )
}

predict.mqrbf <- function(object, newdata){
  
  x_receptors <- newdata$x
  y_receptors <- newdata$y
  x_observations <- object$data$x
  y_observations <- object$data$y
  alpha_weights <- object$alpha_weights
  smoothing_factor <- object$smoothing_factor
  
  n_i <- length(x_receptors)
  n_j <- length(x_observations)
  
  # value of 0.05 is to ensure that a float is used and not int. 
  # Values ({0.0 ... 0.009} == 0) in rep() function of R.
  z <- rep(0.01, n_i)  
  
  for(i in 1:n_i) {
    x_new <- x_receptors[i]
    y_new <- y_receptors[i]
    z_new <- 0
    for(j in 1:n_j) {
      weight_j <- alpha_weights[j]
  
      x_j <- x_observations[j]
      y_j <- y_observations[j]
  
      r <- sqrt( ((x_j-x_new)^2) + ((y_j-y_new)^2) )
      m_distance <- mqrbf.calc_distance(r, smoothing_factor)
  
      z_new <- z_new + (weight_j * m_distance)
    }
    z[i] <- z_new
  }
  
  return(z)
  
}


```

```{r mqrbf_predict}

preds.mqrbf <- predict.mqrbf(model.mqrbf, sf_receptors)

summary(preds.mqrbf)

```

### 4.2.3 IDW

```{r idw_predict}

preds.idw <- predict(model.idw, sf_receptors)$var1.pred
summary(preds.idw)

```

### 4.2.4 Ordinary kriging

```{r od_kriging_predict}

preds.od_kriging <- predict(model.od_kriging, sf_receptors)$var1.pred
summary(preds.od_kriging)

```

### 4.2.5 Universal kriging

```{r od_kriging_predict}

preds.u_kriging.linear <- predict(model.u_kriging.linear, sf_receptors)$var1.pred
preds.u_kriging.hyperbolic <- predict(model.u_kriging.hyperbolic, sf_receptors)$var1.pred

summary(preds.u_kriging.linear)
summary(preds.u_kriging.hyperbolic)

```




## 4.3 Show generated surfaces

### 4.3.1 Trend surface

```{r show_preds_trend_surface}

show_prediction_map(
  preds.trend_surface.linear,
  title_text = "Trend surface (1st order)",
  caption_text = "case_weight = 1.151302"
)

show_prediction_map(
  preds.trend_surface.hyperbolic,
  title_text = "Trend surface (3rd order)",
  caption_text = "case_weight = 1.000508"
)

```


### 4.3.2 MQ-RBF

```{r show_preds_mqrbf}

show_prediction_map(
  preds.mqrbf,
  title_text = "MQ-RBF",
  caption_text = "alpha_seed = 1.166434; smoothing_factor = 90.770461"
)

```

### 4.3.3 IDW

```{r show_preds_idw}

show_prediction_map(
  preds.idw,
  title_text = "IDW",
  caption_text = "nmax=6; idp=1.028791"
)

```

### 4.3.4 Ordinary kriging

```{r show_preds_od_kriging}

show_prediction_map(
  preds.od_kriging,
  title_text = "Ordinary Kriging",
  caption_text = "vgm=\"Sph\"; psill=348.3421; range=40943.12; nmax=6"
)

```

### 4.3.4 Universal kriging

```{r show_preds_u_kriging}

show_prediction_map(
  preds.u_kriging.linear,
  title_text = "Universal Kriging (1st order)",
  caption_text = "vgm=\"Sph\"; psill=188.709; range=13714.15; nmax=6"
)

show_prediction_map(
  preds.u_kriging.hyperbolic,
  title_text = "Universal Kriging (3rd order)",
  caption_text = "vgm=\"Sph\"; psill=188.7081; range=13714.12; nmax=6"
)

```



## 4.4 Calculate RMSE and Normalized RMSE (NRMSE)
### 4.4.1 Trend surface

```{r calc_rmse_trend_surface}

results.trend_surface.linear <- train(
  windspeed ~ x + y,
  method = "lm",
  data = sf_observations,
  trControl = trainControl(method = "LOOCV"),
  weights = (1 / windspeed) + 1.151302
)

results.trend_surface.hyperbolic <- train(
  windspeed ~ x + y + I(x^2) + (x * y) + I(y^2) + I(x^3) + (I(x^2) * y) + (x * I(y^2)) + I(y^3),
  method = "lm",
  data = sf_observations,
  trControl = trainControl(method = "LOOCV"),
  weights = (1 / windspeed) + 1.000508
)

results.trend_surface.linear.rmse <- calc_rmse(resid(results.trend_surface.linear))
results.trend_surface.hyperbolic.rmse <- calc_rmse(resid(results.trend_surface.hyperbolic))

results.trend_surface.linear.nrmse <- calc_nrmse(results.trend_surface.linear.rmse, sf_observations)
results.trend_surface.hyperbolic.nrmse <- calc_nrmse(results.trend_surface.hyperbolic.rmse, sf_observations)

```

### 4.4.2 MQ-RBF

```{r define_cv_model_mqrbf}

train.mqrbf <- function(model){
    
  x_observations <- model$data$x
  y_observations <- model$data$y
  z_observations <- model$data$windspeed
  alpha_seed <- model$alpha_seed
  smoothing_factor <- model$smoothing_factor
  
  n <- length(x_observations)
  residuals <- rep(0.01, n)
  
  for(i in 1:n) {
    x_train <- x_observations[-i]
    y_train <- y_observations[-i]
    z_train <- z_observations[-i]
    data_train <- data.frame(x = x_train, y = y_train, windspeed = z_train)
    
    x_new <- as.vector(x_observations[i])
    y_new <- as.vector(y_observations[i])
    newdata <- list(x = x_new, y = y_new)
    
    model <- mqrbf.calc_alpha_weights(data_train, alpha_seed, smoothing_factor)
    
    z_new <- predict.mqrbf(model, newdata)
    
    residuals[i] <- (z_observations[i] - z_new)
  }
  
  return(list(residuals=residuals))
}

```

```{r calc_rmse_mqrbf}

results.mqrbf <- train.mqrbf(model.mqrbf)
results.mqrbf.rmse <- calc_rmse(results.mqrbf$residuals)
results.mqrbf.nrmse <- calc_nrmse(results.mqrbf.rmse, sf_observations)

```

### 4.4.3 IDW

```{r calc_rmse_idw}

results.idw <- train.gstat(model.idw)
results.idw.rmse <- calc_rmse(results.idw$residuals)
results.idw.nrmse <- calc_nrmse(results.idw.rmse, sf_observations)
  
```

### 4.4.4 Ordinary kriging

```{r calc_rmse_od_kriging}

results.od_kriging <- train.gstat(model.od_kriging)
results.od_kriging.rmse <- calc_rmse(results.od_kriging$residuals)
results.od_kriging.nrmse <- calc_nrmse(results.od_kriging.rmse, sf_observations)
  
```

### 4.4.4 Universal kriging

```{r calc_rmse_od_kriging}

results.u_kriging.linear <- train.gstat(model.u_kriging.linear)
results.u_kriging.hyperbolic <- train.gstat(model.u_kriging.hyperbolic)

results.u_kriging.linear.rmse <- calc_rmse(results.u_kriging.linear$residuals)
results.u_kriging.hyperbolic.rmse <- calc_rmse(results.u_kriging.hyperbolic$residuals)

results.u_kriging.linear.nrmse <- calc_nrmse(results.u_kriging.linear.rmse, sf_observations)
results.u_kriging.hyperbolic.nrmse <- calc_nrmse(results.u_kriging.hyperbolic.rmse, sf_observations)
  
```


# 5. Conclusion

```{r compare_rmse_nrmse_per_model}

model_names <- c(
  "Trend surface (1st order)",
  "Trend surface (3rd order)",
  "MQ-RBF",
  "IDW",
  "Ordinary kriging",
  "Universal kriging (1st order)",
  "Universal kriging (3rd order)"
)

model_weights <- c(
  "case_weight = 1.151302",
  "case_weight = 1.000508",
  "alpha_seed = 1.166434; smoothing_factor = 90.770461",
  "nmax=6; idp=1.028791",
  "vgm=\"Sph\"; psill=348.3421; range=40943.12; nmax=6",
  "vgm=\"Sph\"; psill=188.709; range=13714.15; nmax=6",
  "vgm=\"Sph\"; psill=188.7081; range=13714.12; nmax=6"
)

model_rmse_values <- c(
  results.trend_surface.linear.rmse,
  results.trend_surface.hyperbolic.rmse,
  results.mqrbf.rmse,
  results.idw.rmse,
  results.od_kriging.rmse,
  results.u_kriging.linear.rmse,
  results.u_kriging.hyperbolic.rmse
)

model_nrmse_values <- c(
  results.trend_surface.linear.nrmse,
  results.trend_surface.hyperbolic.nrmse,
  results.mqrbf.nrmse,
  results.idw.nrmse,
  results.od_kriging.nrmse,
  results.u_kriging.linear.nrmse,
  results.u_kriging.hyperbolic.nrmse
)

results.all_models <- 
  data.frame(
    model_name = model_names,
    model_weight = model_weights,
    rmse = model_rmse_values,
    nrmse = model_nrmse_values
  )

```

```{r show_rmse_nrmse_results}

results.all_models

```